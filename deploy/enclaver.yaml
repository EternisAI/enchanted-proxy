version: v1
name: enchanted-proxy/server
target: ghcr.io/eternisai/enchanted-proxy/server:${version}
sources:
  app: ghcr.io/eternisai/enchanted-proxy/server-base:${version}@${digest}
  supervisor: ghcr.io/eternisai/odyn:v0.5.0-eternis.2@sha256:db6b305a620656cb4916d5713dcb12a2110d45c04ea3a621672f685aa6fa05d0
  wrapper: ghcr.io/eternisai/enclaver-wrapper-base:v0.5.0-eternis.2@sha256:2632b353dac79c175ed3613569e76c051109cda7ada0bcc456001fdc32c87dfc
defaults:
  cpu_count: 2
  memory_mb: 2048
api:
  listen_port: 9900
ingress:
# TLS ingress Proxy API endpoint
- listen_port: 8180
# TLS ingress Telegram API endpoint
- listen_port: 8181
# Prometheus Node Exporter metrics API
- listen_port: 9100
# TLS ingress proxy status endpoint
- listen_port: 9101
egress:
  allow:
  # API client endpoints
  - api.telegram.org
  - backend.composio.dev
  # App Store Server API (IAP verification)
  - api.storekit.itunes.apple.com
  - api.storekit-sandbox.itunes.apple.com
  # Stripe API
  - api.stripe.com
  # MCP API client endpoints
  - api.perplexity.ai
  - api.replicate.com
  - www.googleapis.com
  # OAuth API client endpoints
  - api.twitter.com
  - oauth2.googleapis.com
  - slack.com
  # Proxied API endpoints
  - api.kraken.com
  - api.openai.com
  - inference.tinfoil.sh
  - openrouter.ai
  - serpapi.com
  - api.exa.ai
  - cloud-api.near.ai
  - us-east-1.aws.api.temporal.io
  # Internal API endpoints
  - 7697efc6.igw.ghostagent.org
  - glm-46.llm.eternisai.net
  - server-dev.zcash-payment-backend.svc
  - server-staging.zcash-payment-backend.svc
  - server.zcash-payment-backend.svc
  - zcash.eternisai.net
  # Internal deepresearch API endpoint
  - flow-dev.dr-use1.ghostagent.org
  - flow.deepr.freysa.ai
  # Self-hosted Venice (GCP)
  - 34.30.193.13
  # aws-0-us-east-2.pooler.supabase.com
  - 3.13.175.194
  - 3.139.14.59
  - 13.59.95.192
  # aws-1-us-east-1.pooler.supabase.com
  - 3.227.209.82
  - 18.213.155.45
  - 18.214.78.123
  # db.zwcxttrzlaxtbyitpaip.supabase.co
  - 3.151.95.224
  # Firestore (used by deepresearch user tracking)
  - firestore.googleapis.com
  # Firebase Cloud Messaging (push notifications)
  - fcm.googleapis.com
  # Linear API (problem reports)
  - api.linear.app
env:
- APPSTORE_API_KEY_ID
- APPSTORE_API_KEY_P8
- APPSTORE_BUNDLE_ID
- APPSTORE_ISSUER_ID
- COMPOSIO_API_KEY
- COMPOSIO_TWITTER_CONFIG
- CORS_ALLOWED_ORIGINS
- DATABASE_URL
- DB_CONN_MAX_IDLE_TIME_MINUTES
- DB_CONN_MAX_LIFETIME_MINUTES
- DB_MAX_IDLE_CONNS
- DB_MAX_OPEN_CONNS
- DEEPR_STORAGE_PATH
- DEEP_RESEARCH_WS
- DEEP_RESEARCH_WS_SCHEME
- ENABLE_TELEGRAM_SERVER
- ETERNIS_INFERENCE_API_KEY
- EXA_API_KEY
- FALLBACK_CHECK_INTERVAL
- FALLBACK_PROMETHEUS_TOKEN
- FALLBACK_PROMETHEUS_URL
- FIREBASE_CRED_JSON
- FIREBASE_PROJECT_ID
- FREE_MONTHLY_PLAN_TOKENS
- GIN_MODE
- GOOGLE_CLIENT_ID
- GOOGLE_CLIENT_SECRET
- JWT_JWKS_URL
- LINEAR_API_KEY
- LINEAR_LABEL_ID
- LINEAR_PROJECT_ID
- LINEAR_TEAM_ID
- LOG_FORMAT
- LOG_LEVEL
- MESSAGE_STORAGE_BUFFER_SIZE
- MESSAGE_STORAGE_CACHE_SIZE
- MESSAGE_STORAGE_CACHE_TTL_MINUTES
- MESSAGE_STORAGE_ENABLED
- MESSAGE_STORAGE_TIMEOUT_SECONDS
- MESSAGE_STORAGE_WORKER_POOL_SIZE
- NATS_URL
- NEAR_API_KEY
- OPENAI_API_KEY
- OPENROUTER_API_KEY
- OPENROUTER_DESKTOP_API_KEY
- OPENROUTER_MOBILE_API_KEY
- PERPLEXITY_API_KEY
- PORT
- PRO_DAILY_PLAN_TOKENS
- RATE_LIMIT_ENABLED
- RATE_LIMIT_LOG_ONLY
- RATE_LIMIT_SOFT_MULTIPLIER
- REPLICATE_API_TOKEN
- REQUEST_TRACKING_BUFFER_SIZE
- REQUEST_TRACKING_TIMEOUT_SECONDS
- REQUEST_TRACKING_WORKER_POOL_SIZE
- SERPAPI_API_KEY
- SERVER_SHUTDOWN_TIMEOUT_SECONDS
- SLACK_CLIENT_ID
- SLACK_CLIENT_SECRET
- STRIPE_SECRET_KEY
- STRIPE_WEBHOOK_SECRET
- STRIPE_WEEKLY_PRICE_ID
- TELEGRAM_TOKEN
- TEMPORAL_API_KEY
- TEMPORAL_ENDPOINT
- TEMPORAL_NAMESPACE
- TINFOIL_API_KEY
- TWITTER_CLIENT_ID
- VALIDATOR_TYPE
- ZCASH_BACKEND_API_KEY
- ZCASH_DEBUG_MULTIPLIER
files:
- /etc/ssl/certs/eternis/llm-ca.pem
- /var/run/secrets/tls/tls.crt
- /var/run/secrets/tls/tls.key
